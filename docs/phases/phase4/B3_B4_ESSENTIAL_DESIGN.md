# B-3, B-4 ワークフロー本質設計書

## なぜこれらのワークフローが必要なのか

### sebas-chanの根本思想：「安全なフォーゲッタ」

sebas-chanは、ユーザーが**安心して情報を忘れる**ことを可能にするシステムです。現代社会では管理すべき情報量が個人の認知能力を超えており、常に「何か忘れていないか」という不安を抱えながら生活しています。sebas-chanはこの不安を解消し、ユーザーが「今、目の前のこと」に集中できる環境を提供します。

この目的を達成するために、B-3とB-4は以下の役割を担います：

- **B-3（UPDATE_FLOW_PRIORITIES）**: 「今、何に集中すべきか」を自動的に判断
- **B-4（SALVAGE_FROM_POND）**: 「忘れた情報から価値あるものを自動発掘」

## B-3: UPDATE_FLOW_PRIORITIES - 認知的負荷の軽減

### これは何か

B-3は、ユーザーの「外部脳」として機能し、複数のFlow（作業の流れ）の中から「今、最も注力すべきもの」を自動的に判断するワークフローです。

### なぜ必要か

人間の脳は同時に管理できるタスクの数に限界があります（一般的に7±2個と言われています）。しかし現実には数十のプロジェクトや課題を抱えることが珍しくありません。B-3は以下の問題を解決します：

1. **優先順位付けの疲労**: 毎日「何から手を付けるべきか」を考えることは認知的に疲れる
2. **重要なものの見落とし**: 多数のタスクに埋もれて本当に重要なものを見失う
3. **状況変化への対応遅れ**: 外部状況が変わっても優先度の見直しを忘れる

### 動作原理

B-3は以下の情報を総合的に判断して、各Flowの優先度スコア（0.0〜1.0）を動的に調整します：

#### 判断基準

1. **緊急性（Urgency）**
   - 期限が迫っているか
   - ブロッカーになっているか
   - 他の作業を止めているか

2. **重要性（Importance）**
   - 含まれるIssueの重要度
   - 他のFlowへの影響度
   - システムルールでの定義

3. **停滞度（Staleness）**
   - 最後に更新されてからの経過時間
   - 放置による腐敗リスク
   - 「忘れ去られている」可能性

4. **勢い（Momentum）**
   - 最近の活動頻度
   - 進捗の速度
   - 「今やれば終わる」度合い

### 重要な設計判断

#### 優先度は「提案」であり「命令」ではない

B-3が計算する優先度はあくまで提案です。最終的な判断はユーザーが行います。これは「ユーザー主権」という設計思想に基づいています。

#### 時間帯や曜日の考慮（将来実装）

現在のシステムは時間の概念を持っていませんが、将来的には以下を考慮する予定です：
- 朝は重要なタスク、夕方は軽いタスク
- 月曜は計画的タスク、金曜は整理タスク
- ユーザーの生活リズムに合わせた調整

## B-4: SALVAGE_FROM_POND - 忘却の安全性保証

### これは何か

B-4は、Pond（すべての情報が流れ込む「池」）に蓄積された情報から、時間が経って価値が顕在化したものを自動的に発掘するワークフローです。

### なぜ必要か

Pondには以下のような情報が日々流れ込みます：
- Slackの会話
- メールの内容
- ユーザーのメモ
- システムイベント

これらの99%は「ノイズ」ですが、1%には後から見ると価値のある情報が含まれています：

1. **パターンの発見**: 単独では意味がなくても、複数集まるとパターンが見える
2. **忘れられたアイデア**: その時は重要でなかったが、状況が変わって価値が生まれた
3. **隠れた関連性**: 一見無関係な情報同士の意外なつながり

### Pondとは何か

Pondは「池」のメタファーです：
- **流入**: あらゆる情報が区別なく流れ込む
- **沈殿**: 時間とともに情報が層を成して堆積
- **発酵**: 時間経過により新たな価値が生まれる
- **サルベージ**: 価値あるものを引き上げる

### サルベージの仕組み

#### 1. 価値判定の基準

以下のパターンを検出します：

**繰り返しパターン（Recurring Pattern）**
- 同じ話題が3回以上出現
- 例：「データベースが遅い」という話が何度も出てくる → 潜在的な問題

**忘れられたタスク（Forgotten Task）**
- 言及されたが処理されていない事項
- 例：「来月までに○○を確認」→ 誰も覚えていない

**学習可能な知見（Learning）**
- 問題と解決策のペア
- 例：エラーメッセージとその対処法が同じPondに存在

**異常検出（Anomaly）**
- 通常と異なるパターン
- 例：いつもと違う時間帯のアクセス

#### 2. クラスタリング

ベクトル検索（LanceDB + 日本語埋め込みモデル）により、意味的に類似した情報をグループ化します。これにより：
- 表現が違っても同じ意味の情報をまとめる
- 時間的に離れた関連情報を結びつける
- 言語の違いを超えた関連性を発見

#### 3. 価値の創出

発見された情報は以下の形で価値化されます：

**Knowledge化**
- パターンや知見を永続的な知識として保存
- 将来の類似状況で再利用可能

**Issue化**
- 忘れられていた重要事項を追跡可能にする
- 適切なFlowに組み込まれる

**Summary作成**
- 期間内の出来事を要約
- 振り返りや報告に活用

>>> これはKnowledgeとして存在することを想定しています。少し分類が強引にはなりますが

### 重要な設計判断

#### 処理済み管理

一度サルベージした情報を再度処理しないよう、処理済みフラグを管理します。ただし：
- PondEntry自体は変更しない（イミュータブル）
- 別テーブルで処理履歴を管理
- 必要に応じて再サルベージも可能

>>> しません。「それ」がどのような意味を持つかはミクロからの視点ではわからないからです。
>>> むしろ、現在生きている（あるいは終了していても直近の）Flowでなにが行われたかが重要です。
>>> 基本的には、生きているIssueに登録されているかどうかが１つの基準になります。最初にFlowの一覧を調べて、そこから調べ直すイメージですかね...。「11月の予定」が作られていれば、それをキーとしてpondを捜索するのは理にかなっています。
>>> 特にキーがなければ、重要なのは「サンプリング調査」でしょう。pondから適当なinputを引っ張り出して、似たものを探します。
>>> このフローはかなり生成AIの柔軟性に依ることがわかります。
>>> Flowの観点からIssueのクラスタを作るように、Flowの・定型の・サンプリングに依る「観点」からinputを検索する作業です。3パターンの「観点」の生成方法がとりあえず思い浮かびますね。
>>> 「暇な時にやる作業」なので、効率は度外視です。

#### サルベージの頻度

頻繁すぎるとノイズになり、稀すぎると価値を見逃します：
- デフォルト：週次実行
- 情報の鮮度と処理コストのバランス
- ユーザーの活動量に応じて調整

## B-3とB-4の相互作用

これらのワークフローは協調して「安心して忘れる」を実現します：

1. **B-4がIssueを発見** → **B-3が優先度を判定**
   - サルベージで見つかった重要事項が適切なタイミングで浮上

2. **B-3が低優先度と判定** → **B-4が後で再評価**
   - 今は重要でないものも、時間が経てば価値が変わる可能性

3. **相互フィードバック**
   - B-3の優先度履歴がB-4の価値判定に影響
   - B-4の発見パターンがB-3の重要度計算に反映

## 実装における本質的な問い

### B-3への問い

1. **優先度の「正解」とは何か？**
   - ユーザーが実際に選ぶものが正解
   - しかしユーザーの選択も常に最適とは限らない
   - 学習と適応のバランスが必要

>>> 避けるべき失敗はあります。「重要なことを見逃す」「多すぎて埋もれる」の2点で、この2つは矛盾しています。
>>> したがって、本質的に正解はないとも言えます。これはしょうがない。
>>> ユーザは「忘れている」ので、正解をもっていません。ただ、信頼を得る必要はあります。
>>> そのために必要なひとつは、システムは「忘れない」ということです。必要なことをちゃんと思い出させるという点において、システムは信用されなければなりません。
>>> したがって重要なことの1つは、「勝手に完了しない」とか「ユーザにおもねって嘘を付く」というような行動を取らないことです。
>>> ただ、問題の多くは「自明」であると考えています。仕事をするか買い物をするか昼寝をするかは、正直なところ多くの場合自明であり、それが自明であるために必要なのは「コンテキスト」です。
>>> state文書のような曖昧な入力を存在させているのはこの部分での柔軟性を持たせるためで、Flow優先度に関してはこの点が特に重要です。（stateの価値について何処かにメモ）
>>> システムにとっての「正解」は、コンテキストの理解を十分に行って「自明な答え」を出し続けることです。コンテキストがズレたまま勝手に判断すれば信頼を失うでしょう。これが最も避けるべき「失敗」です。

2. **停滞と熟成の違いをどう判断するか？**
   - 放置されているのか、寝かせているのか
   - コンテキストと履歴から推測

>>> ユーザが判断します。これは単純です。勝手な判断が危険です。
>>> 「ユーザにどう聞くか」という問題はじつは仕組み上、十分に整えられていませんが、これについても検討するべきですね。
>>> context.xxxxxxに書き込む、みたいな感じかもしれません。

3. **個人差をどう吸収するか？**
   - 人によって優先度の基準は異なる
   - パーソナライゼーションの必要性

>>> ユーザに聞けばいいじゃないですかね。勝手に判断することは実は危険です。
>>> ユーザは「忘れるため」にシステムに依存しています。システムは「忘れ去られないため」に活動します。ここには緊張関係があり、しかし、そのために協調する必要性が存在します。このシステムは人だけでもAIだけでも存在し得ないシステムであり、どちらもシステムの一部です。（これは重要な点なので、いつでも見られるところに書いておいて）

### B-4への問い

1. **ノイズと信号の境界はどこか？**
   - 99%のノイズから1%の価値を見つける
   - 偽陽性と偽陰性のトレードオフ

>>> サルベージされたものに対する評価や、処理手順について自然言語的に補強できるようにしたいところですね。もともと、最初の実装では「サルベージ手順」というKnowledgeを用いて、ユーザ・システム定義された作業手順として記載するという方針を立てていたような？

2. **時間経過による価値変化をどうモデル化するか？**
   - 情報の賞味期限
   - 熟成による価値向上
   - 文脈の変化による再評価

>>> これは正直やってみないとわからないところもあるので、現時点で完璧に作れない部分だと思います。プロンプトや作業手順、作業ガイドなどを柔軟に変更できるように設計するところからですかね。

3. **プライバシーと有用性のバランス**
   - すべてを記憶することの危険性
   - 忘れる権利の保証
   - 必要な情報の保持

>>> このシステムは完全に個人がローカルPC上で、全ての個人情報を含めて自分のために利用することを想定しています。システムの中身や情報を外部のシステムに共有することは想定していません。

## まとめ：「外部脳」としての責任

B-3とB-4は、単なる優先度計算やデータマイニングツールではありません。これらは人間の認知能力を拡張し、「安心して忘れる」ことを可能にする「外部脳」の中核機能です。

実装にあたっては、以下の原則を常に念頭に置く必要があります：

1. **透明性**: なぜその優先度なのか、なぜそれが価値があるのかを説明できる
2. **制御可能性**: ユーザーが最終的な判断を下せる
3. **適応性**: 個人の特性や状況の変化に対応できる
4. **信頼性**: 重要なものを見逃さない、ノイズで溢れさせない

これらの原則を守りながら、技術的な実装を進めていきます。

---

**作成日**: 2025-10-13
**Issue**: #44