# システムアーキテクチャ

## 全体構成

sebas-chanは、内部コアとMCPサーバーから構成される思考バックエンドサービスです。

```
┌─────────────────────────────────────────┐
│       sebas-chan System                │
│                                         │
│  ┌─────────────────────────────────┐  │
│  │  Core Agent (思考ループ)         │  │
│  │  - Event Queue                  │  │
│  │  - Cognitive Workflows          │  │
│  └─────────────────────────────────┘  │
│                                         │
│  ┌─────────────────────────────────┐  │
│  │  Data Stores                    │  │
│  │  - Issues                       │  │
│  │  - Flows                        │  │
│  │  - Knowledge                    │  │
│  │  - Pond                         │  │
│  │  - State Document               │  │
│  └─────────────────────────────────┘  │
│                                         │
│  ┌─────────────────────────────────┐  │
│  │  Reporters                      │  │
│  │  - Gmail, Slack, etc.           │  │
│  └─────────────────────────────────┘  │
│                                         │
│  ┌─────────────────────────────────┐  │
│  │  MCP Server                     │  │
│  └─────────────────────────────────┘  │
└─────────────────────────────────────────┘
                    │
                    │ MCP Protocol
                    ▼
┌─────────────────────────────────────────┐
│       External MCP Clients              │
│  - CLI / Debug UI                       │
│  - Custom Web UI                        │
│  - Other AI Agents                      │
└─────────────────────────────────────────┘
```

## コンポーネント詳細

### Core Agent

イベントキューベースの思考エンジン。以下の処理フローで動作します：

1. イベントキューからイベントを取り出す
2. 対応する思考ワークフローを実行
3. 必要に応じて新たなイベントをキューに追加
4. キューが空になるまでループを継続

### 思考ワークフロー

TypeScriptでハードコードされた自己完結型の処理単位。主要なワークフローのカテゴリ：

- **A: 個別要素の処理** - Input処理、Issue分析、Knowledge抽出
- **B: 横断的な分析** - クラスタリング、優先度更新、Pondサルベージ
- **C: ユーザー提案** - 次のFlow/Action提案
- **D: 自己調整** - システムパラメータの自律的調整

### データストア

- **Issue**: 行動可能な管理単位（GitHubのIssueモデル）
- **Flow**: 複数のIssueをまとめた作業の流れ
- **Knowledge**: 完了したIssueから抽出された永続的な知識
- **Pond**: 未整理情報のベクトル化ストア
- **State Document**: システム全体で共有される単一の自然言語ワーキングメモリ

### MCP Server

唯一の公開インターフェース。標準化されたMCPプロトコルで外部クライアントと通信。

## 技術スタック

- **言語**: TypeScript（メインロジック）、Python（DB層）
- **データベース**: LanceDB（ベクトルDB）
- **プロセス間通信**: JSON-RPC over stdio
- **フレームワーク**: 独自開発のModularプロンプトフレームワーク
- **Web UI**: SvelteKit